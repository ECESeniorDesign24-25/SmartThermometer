<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature Graph - Two Sensors</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Ensure body takes up full height */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Individual forms - align elements in one line */
        form {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        label, input, select {
            margin-right: 10px;
            font-size: 1em;
        }

        input[type="text"], select {
            width: 150px;
            padding: 5px;
            font-size: 1em;
        }

        button {
            padding: 5px 15px;
            font-size: 1em;
            margin-left: 10px;
            background-color: white;
            color: black;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #f0f0f0;
        }

        /* Flexbox container for sensor buttons */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Status text styling */
        .status {
            text-align: center;
            margin-top: 20px;
            font-size: 1.3em;
        }

        /* Chart container styling */
        .chart-container {
            position: relative;
            width: 1000px;
            height: 600px;
            margin: 0 auto;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Temperature Graph - Two Sensors</h1>

        <form method="POST" action="/user">
            <label for="email">Email:</label>
            <input type="text" id="email" name="email" required>

            <label for="phone">Phone Number:</label>
            <input type="text" id="phone" name="phone" required>

            <label for="carrier">Carrier:</label>
            <select id="carrier" name="carrier" required>
                <option value="ATT">AT&T</option>
                <option value="TMOBILE">T-Mobile</option>
                <option value="VERIZON">Verizon</option>
                <option value="SPRINT">Sprint</option>
            </select>

            <button type="submit">Submit</button>
        </form>

        <form method="GET" action="/max_min">
            <label for="max">Max Temp:</label>
            <input type="text" id="max" name="max" required>

            <label for="min">Min Temp:</label>
            <input type="text" id="min" name="min" required>

            <button type="submit">Set Max and Min</button>
        </form>

        <div class="button-container">
            <form method="POST" action="/power_on">
                <button type="submit">Turn Sensors On</button>
            </form>
            <form method="POST" action="/power_off">
                <button type="submit">Turn Sensors Off</button>
            </form>
        </div>

        <div class="status" id="temperatureStatus1">Sensor 1 Temperature: Loading...</div>
        <div class="status" id="temperatureStatus2">Sensor 2 Temperature: Loading...</div>

        <!-- Chart -->
        <div class="chart-container">
            <canvas id="temperatureChart"></canvas>
        </div>
    </div>

    <script>
        // Form Submission Handlers
        $(document).ready(function() {
            // User Info Form Submission
            $("form[action='/user']").submit(function(event) {
                event.preventDefault();
                const formData = $(this).serialize();

                $.get("/user", formData, function(response) {
                    alert("User info submitted successfully!");
                }).fail(function() {
                    alert("Error submitting user info!");
                });
            });

            // Max/Min Temperature Form Submission
            $("form[action='/max_min']").submit(function(event) {
                event.preventDefault();
                const formData = $(this).serialize();

                $.get("/max_min", formData, function(response) {
                    alert("Max/Min temperatures set successfully!");
                }).fail(function() {
                    alert("Error setting Max/Min temperatures!");
                });
            });

            // Power Off/On Form Submissions
            $("form[action='/power_off']").submit(function(event) {
                event.preventDefault();
                $.get("/power_off", function(response) {
                    alert("Sensors turned off successfully!");
                }).fail(function() {
                    alert("Error turning off sensors!");
                });
            });

            $("form[action='/power_on']").submit(function(event) {
                event.preventDefault();
                $.get("/power_on", function(response) {
                    alert("Sensors turned on successfully!");
                }).fail(function() {
                    alert("Error turning on sensors!");
                });
            });
        });

        // Chart code (no changes needed)
        const ctx = document.getElementById('temperatureChart').getContext('2d');
        let timeElapsed = 0;
        const MAX_TIME = 300;
        const temperatureChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Sensor 1 Temperature',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false,
                        yAxisID: 'yCelsius'
                    },
                    {
                        label: 'Sensor 2 Temperature',
                        data: [],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        fill: false,
                        yAxisID: 'yCelsius'
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        reverse: true,
                        title: {
                            display: true,
                            text: 'Time (seconds)'
                        },
                        min: 0,
                        max: 300,
                        ticks: {
                            autoSkip: false
                        }
                    },
                    yCelsius: {
                        position: 'left',
                        min: 10,
                        max: 50,
                        title: {
                            display: true,
                            text: 'Temperature (째C)'
                        }
                    },
                    yFahrenheit: {
                        position: 'right',
                        min: 50,
                        max: 122,
                        title: {
                            display: true,
                            text: 'Temperature (째F)'
                        }
                    }
                }
            }
        });

                async function updateChart(sensor1Temperature, sensor2Temperature) {
            if (timeElapsed < MAX_TIME) {
                timeElapsed++;
            }

            temperatureChart.data.datasets[0].data.forEach(function(point) {
                point.x += 1;
            });

            temperatureChart.data.datasets[1].data.forEach(function(point) {
                point.x += 1;
            });

            if (sensor1Temperature !== null && sensor1Temperature !== -110000.0) {
                temperatureChart.data.datasets[0].data.push({ x: 0, y: sensor1Temperature });
            }

            if (sensor2Temperature !== null && sensor2Temperature !== -110000.0) {
                temperatureChart.data.datasets[1].data.push({ x: 0, y: sensor2Temperature });
            }

            if (timeElapsed >= MAX_TIME) {
                temperatureChart.data.datasets[0].data.shift();
                temperatureChart.data.datasets[1].data.shift();
            }

            temperatureChart.update();
        }

        async function fetchTemperature1Data() {
            try {
                const response = await fetch('/temperature1');
                const data = await response.json();
                const currentTemperature = data.temperature || null;

                document.getElementById('temperatureStatus1').textContent =
                    currentTemperature !== null ?
                    `Sensor 1 Temperature: ${currentTemperature} 째C` :
                    'Sensor 1 is unplugged';

                return currentTemperature;

            } catch (error) {
                document.getElementById('temperatureStatus1').textContent = 'Sensor 1: No Data Available';
                return null;
            }
        }

        async function fetchTemperature2Data() {
            try {
                const response = await fetch('/temperature2');
                const data = await response.json();
                const currentTemperature = data.temperature || null;

                document.getElementById('temperatureStatus2').textContent =
                    currentTemperature !== null ?
                    `Sensor 2 Temperature: ${currentTemperature} 째C` :
                    'Sensor 2 is unplugged';

                return currentTemperature;

            } catch (error) {
                document.getElementById('temperatureStatus2').textContent = 'Sensor 2: No Data Available';
                return null;
            }
        }

        async function fetchAndUpdateData() {
            const sensor1Temperature = await fetchTemperature1Data();
            const sensor2Temperature = await fetchTemperature2Data();
            await updateChart(sensor1Temperature, sensor2Temperature);
        }

        setInterval(fetchAndUpdateData, 1000);
    </script>
</body>
</html>
